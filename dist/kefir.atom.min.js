!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(e.kefir||(e.kefir={})).atom=t()}}(function(){return function t(e,n,i){function r(u,s){if(!n[u]){if(!e[u]){var f="function"==typeof require&&require;if(!s&&f)return f(u,!0);if(o)return o(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var a=n[u]={exports:{}};e[u][0].call(a.exports,function(t){var n=e[u][1][t];return r(n||t)},a,a.exports,t,e,n,i)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<i.length;u++)r(i[u]);return r}({1:[function(t,e,n){"use strict";function i(){for(;g.length;){var t=g.shift(),e=A.shift(),n=e._currentEvent.value;(0,d.identicalU)(t,n)||e._emitValue(n)}}function r(t){++p;try{return t()}finally{--p||i()}}function o(){y.Property.call(this)}function u(t){o.call(this),this._source=t,this._$onAny=null}function s(t,e){u.call(this,t),this._lens=e}function f(){o.call(this),arguments.length&&this._emitValue(arguments[0])}function c(t,e){if(t instanceof o&&e.indexOf(t)<0)e.push(t);else if((0,d.isArray)(t))for(var n=0,i=t.length;n<i;++n)c(t[n],e);else if((0,d.isObject)(t))for(var r in t)c(t[r],e)}function a(t){if(t instanceof o)return t.get();if((0,d.isArray)(t)){for(var e=t.length,n=Array(e),i=0;i<e;++i)n[i]=a(t[i]);return n}if((0,d.isObject)(t)){var r={};for(var u in t)r[u]=a(t[u]);return r}return t}function l(){throw new Error("Molecule cannot change the template.")}function h(t,e){if(t instanceof o)return t.set(e);if((0,d.isArray)(t)&&(0,d.isArray)(e))for(var n=0,i=t.length;n<i;++n)h(t[n],e[n]);else if((0,d.isObject)(t)&&(0,d.isObject)(e))for(var r in t)h(t[r],e[r]);else(0,d.identicalU)(t,e)||l()}function v(t){var e=[];c(t,e),u.call(this,(0,y.combine)(e)),this._template=t}function _(){return arguments.length?new f(arguments[0]):new f}Object.defineProperty(n,"__esModule",{value:!0}),n.holding=r,n.AbstractMutable=o,n.MutableWithSource=u,n.LensedAtom=s,n.Atom=f,n.Molecule=v,n.default=_;var d=t("infestines"),y=t("kefir"),m=t("partial.lenses"),p=0,g=[],A=[];(0,d.inherit)(o,y.Property,{set:function(t){this.modify((0,d.always)(t))},remove:function(){this.set()},view:function(t){return new s(this,t)},_maybeEmitValue:function(t){var e=this._currentEvent;e&&(0,d.identicalU)(e.value,t)||this._emitValue(t)}}),(0,d.inherit)(u,o,{get:function(){var t=this._currentEvent;return t&&!p?t.value:this._getFromSource()},_onAny:function(){this._maybeEmitValue(this._getFromSource())},_onActivation:function(){var t=this,e=function(){return t._onAny()};this._$onAny=e,this._source.onAny(e)},_onDeactivation:function(){this._source.offAny(this._$onAny),this._$onAny=null,this._currentEvent=null}}),(0,d.inherit)(s,u,{set:function(t){this._source.set((0,m.set)(this._lens,t,this._source.get()))},modify:function(t){this._source.modify((0,m.modify)(this._lens,t))},_getFromSource:function(){return(0,m.get)(this._lens,this._source.get())}}),(0,d.inherit)(f,o,{get:function(){var t=this._currentEvent;return t?t.value:void 0},set:function(t){var e=this._currentEvent;this._set(e,e?e.value:void 0,t)},modify:function(t){var e=this._currentEvent,n=e?e.value:void 0;this._set(e,n,t(n))},_set:function(t,e,n){p?(A.indexOf(this)<0&&(g.push(t?e:l),A.push(this)),t?t.value=n:this._currentEvent={type:"value",value:n}):this._maybeEmitValue(n)}}),(0,d.inherit)(v,u,{_getFromSource:function(){return a(this._template)},modify:function(t){var e=this,n=t(this.get());r(function(){return h(e._template,n)})}})},{infestines:void 0,kefir:void 0,"partial.lenses":void 0}]},{},[1])(1)});
