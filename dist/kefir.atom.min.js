!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.kefir||(t.kefir={})).atom=e()}}(function(){return function e(t,n,r){function i(u,a){if(!n[u]){if(!t[u]){var f="function"==typeof require&&require;if(!a&&f)return f(u,!0);if(o)return o(u,!0);var l=new Error("Cannot find module '"+u+"'");throw l.code="MODULE_NOT_FOUND",l}var s=n[u]={exports:{}};t[u][0].call(s.exports,function(e){var n=t[u][1][e];return i(n?n:e)},s,s.exports,e,t,n,r)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(){for(;m.length;){var e=m.shift(),t=b.shift(),n=t._currentEvent.value;(0,y.identicalU)(e,n)||t._emitValue(n)}}function a(e){++d;try{return e()}finally{--d||u()}}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e instanceof g&&!t.find(function(t){return t===e}))t.push(e);else if((0,y.isArray)(e))for(var n=0,r=e.length;n<r;++n)f(e[n],t);else if((0,y.isObject)(e))for(var i in e)f(e[i],t);return t}function l(e){if(e instanceof g)return e.get();if((0,y.isArray)(e)){for(var t=e.length,n=Array(t),r=0;r<t;++r)n[r]=l(e[r]);return n}if((0,y.isObject)(e)){var i={};for(var o in e)i[o]=l(e[o]);return i}return e}function s(){throw new Error("Molecule cannot change the template.")}function c(e,t){if(e instanceof g)return e.set(t);if((0,y.isArray)(e)&&(0,y.isArray)(t))for(var n=0,r=e.length;n<r;++n)c(e[n],t[n]);else if((0,y.isObject)(e)&&(0,y.isObject)(t))for(var i in e)c(e[i],t[i]);else(0,y.identicalU)(e,t)||s()}function h(){return arguments.length?new w(arguments[0]):new w}Object.defineProperty(n,"__esModule",{value:!0}),n.Molecule=n.Atom=n.LensedAtom=n.MutableWithSource=n.AbstractMutable=void 0;var v=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.holding=a,n.default=h;var y=e("infestines"),_=e("kefir"),p=e("partial.lenses"),d=0,m=[],b=[],g=n.AbstractMutable=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),v(t,[{key:"set",value:function(e){this.modify(function(){return e})}},{key:"remove",value:function(){this.set()}},{key:"lens",value:function(){return this.view.apply(this,arguments)}},{key:"view",value:function(){return new k(this,p.compose.apply(void 0,arguments))}},{key:"_maybeEmitValue",value:function(e){var t=this._currentEvent;t&&(0,y.identicalU)(t.value,e)||this._emitValue(e)}}]),t}(_.Property),O=n.MutableWithSource=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._source=e,n._$handleAny=null,n}return o(t,e),v(t,[{key:"get",value:function(){var e=this._currentEvent;return e&&!d?e.value:this._getFromSource()}},{key:"_handleAny",value:function(){this._maybeEmitValue(this._getFromSource())}},{key:"_onActivation",value:function(){var e=this,t=function(){return e._handleAny()};this._$handleAny=t,this._source.onAny(t)}},{key:"_onDeactivation",value:function(){this._source.offAny(this._$handleAny),this._$handleAny=null,this._currentEvent=null}}]),t}(g),k=n.LensedAtom=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return o._lens=n,o}return o(t,e),v(t,[{key:"set",value:function(e){this._source.set((0,p.set)(this._lens,e,this._source.get()))}},{key:"modify",value:function(e){this._source.modify((0,p.modify)(this._lens,e))}},{key:"_getFromSource",value:function(){return(0,p.get)(this._lens,this._source.get())}}]),t}(O),w=n.Atom=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return arguments.length&&e._emitValue(arguments[0]),e}return o(t,e),v(t,[{key:"get",value:function(){var e=this._currentEvent;return e?e.value:void 0}},{key:"set",value:function(e){var t=this._currentEvent;this._setInternal(t,t?t.value:void 0,e)}},{key:"modify",value:function(e){var t=this._currentEvent,n=t?t.value:void 0;this._setInternal(t,n,e(n))}},{key:"_setInternal",value:function(e,t,n){var r=this;d?(b.find(function(e){return e===r})||(m.push(e?t:s),b.push(this)),e?e.value=n:this._currentEvent={type:"value",value:n}):this._maybeEmitValue(n)}}]),t}(g);n.Molecule=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,(0,_.combine)(f(e))));return n._template=e,n}return o(t,e),v(t,[{key:"_getFromSource",value:function(){return l(this._template)}},{key:"modify",value:function(e){var t=this,n=e(this.get());a(function(){return c(t._template,n)})}}]),t}(O)},{infestines:void 0,kefir:void 0,"partial.lenses":void 0}]},{},[1])(1)});
