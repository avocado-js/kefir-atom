!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(e.kefir||(e.kefir={})).atom=t()}}(function(){return function t(e,n,i){function r(u,s){if(!n[u]){if(!e[u]){var f="function"==typeof require&&require;if(!s&&f)return f(u,!0);if(o)return o(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var a=n[u]={exports:{}};e[u][0].call(a.exports,function(t){var n=e[u][1][t];return r(n?n:t)},a,a.exports,t,e,n,i)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<i.length;u++)r(i[u]);return r}({1:[function(t,e,n){"use strict";function i(){for(;A.length;){var t=A.shift(),e=b.shift(),n=e._currentEvent.value;(0,y.identicalU)(t,n)||e._emitValue(n)}}function r(t){++g;try{return t()}finally{--g||i()}}function o(){m.Property.call(this)}function u(t){o.call(this),this._source=t,this._$onAny=null}function s(t,e){u.call(this,t),this._setter=e}function f(t,e){u.call(this,t),this._lens=e}function c(){o.call(this),arguments.length&&this._emitValue(arguments[0])}function a(t,e){if(t instanceof o&&e.indexOf(t)<0)e.push(t);else if((0,y.isArray)(t))for(var n=0,i=t.length;n<i;++n)a(t[n],e);else if((0,y.isObject)(t))for(var r in t)a(t[r],e)}function l(t){if(t instanceof o)return t.get();if((0,y.isArray)(t)){for(var e=t.length,n=Array(e),i=0;i<e;++i)n[i]=l(t[i]);return n}if((0,y.isObject)(t)){var r={};for(var u in t)r[u]=l(t[u]);return r}return t}function h(){throw new Error("Molecule cannot change the template.")}function v(t,e){if(t instanceof o)return t.set(e);if((0,y.isArray)(t)&&(0,y.isArray)(e))for(var n=0,i=t.length;n<i;++n)v(t[n],e[n]);else if((0,y.isObject)(t)&&(0,y.isObject)(e))for(var r in t)v(t[r],e[r]);else(0,y.identicalU)(t,e)||h()}function _(t){var e=[];a(t,e),u.call(this,(0,m.combine)(e)),this._template=t}function d(){return arguments.length?new c(arguments[0]):new c}Object.defineProperty(n,"__esModule",{value:!0}),n.holding=r,n.AbstractMutable=o,n.MutableWithSource=u,n.SettableProperty=s,n.LensedAtom=f,n.Atom=c,n.Molecule=_,n.default=d;var y=t("infestines"),m=t("kefir"),p=t("partial.lenses"),g=0,A=[],b=[];(0,y.inherit)(o,m.Property,{set:function(t){this.modify((0,y.always)(t))},remove:function(){this.set()},view:function(t){return new f(this,t)},_maybeEmitValue:function(t){var e=this._currentEvent;e&&(0,y.identicalU)(e.value,t)||this._emitValue(t)}}),(0,y.inherit)(u,o,{get:function(){var t=this._currentEvent;return t&&!g?t.value:this._getFromSource()},_onAny:function(){this._maybeEmitValue(this._getFromSource())},_onActivation:function(){var t=this,e=function(){return t._onAny()};this._$onAny=e,this._source.onAny(e)},_onDeactivation:function(){this._source.offAny(this._$onAny),this._$onAny=null,this._currentEvent=null}}),(0,y.inherit)(s,u,{_getFromSource:function(){var t=this._source._currentEvent;return t&&t.value},set:function(t){(0,this._setter)(t)},modify:function(t){this.set(t(this._getFromSource()))}}),(0,y.inherit)(f,u,{set:function(t){this._source.set((0,p.set)(this._lens,t,this._source.get()))},modify:function(t){this._source.modify((0,p.modify)(this._lens,t))},_getFromSource:function(){return(0,p.get)(this._lens,this._source.get())}}),(0,y.inherit)(c,o,{get:function(){var t=this._currentEvent;return t?t.value:void 0},set:function(t){var e=this._currentEvent;this._set(e,e?e.value:void 0,t)},modify:function(t){var e=this._currentEvent,n=e?e.value:void 0;this._set(e,n,t(n))},_set:function(t,e,n){g?(b.indexOf(this)<0&&(A.push(t?e:h),b.push(this)),t?t.value=n:this._currentEvent={type:"value",value:n}):this._maybeEmitValue(n)}}),(0,y.inherit)(_,u,{_getFromSource:function(){return l(this._template)},modify:function(t){var e=this,n=t(this.get());r(function(){return v(e._template,n)})}})},{infestines:void 0,kefir:void 0,"partial.lenses":void 0}]},{},[1])(1)});
