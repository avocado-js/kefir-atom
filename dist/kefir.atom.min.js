!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.kefir||(t.kefir={})).atom=e()}}(function(){return function e(t,n,i){function r(u,s){if(!n[u]){if(!t[u]){var f="function"==typeof require&&require;if(!s&&f)return f(u,!0);if(o)return o(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var a=n[u]={exports:{}};t[u][0].call(a.exports,function(e){var n=t[u][1][e];return r(n?n:e)},a,a.exports,e,t,n,i)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<i.length;u++)r(i[u]);return r}({1:[function(e,t,n){"use strict";function i(){for(;g.length;){var e=g.shift(),t=A.shift(),n=t._currentEvent.value;(0,d.identicalU)(e,n)||t._emitValue(n)}}function r(e){++p;try{return e()}finally{--p||i()}}function o(){y.Property.call(this)}function u(e){o.call(this),this._source=e,this._$onAny=null}function s(e,t){u.call(this,e),this._lens=t}function f(){o.call(this),arguments.length&&this._emitValue(arguments[0])}function c(e,t){if(e instanceof o&&t.indexOf(e)<0)t.push(e);else if((0,d.isArray)(e))for(var n=0,i=e.length;n<i;++n)c(e[n],t);else if((0,d.isObject)(e))for(var r in e)c(e[r],t)}function a(e){if(e instanceof o)return e.get();if((0,d.isArray)(e)){for(var t=e.length,n=Array(t),i=0;i<t;++i)n[i]=a(e[i]);return n}if((0,d.isObject)(e)){var r={};for(var u in e)r[u]=a(e[u]);return r}return e}function l(){throw new Error("Molecule cannot change the template.")}function h(e,t){if(e instanceof o)return e.set(t);if((0,d.isArray)(e)&&(0,d.isArray)(t))for(var n=0,i=e.length;n<i;++n)h(e[n],t[n]);else if((0,d.isObject)(e)&&(0,d.isObject)(t))for(var r in e)h(e[r],t[r]);else(0,d.identicalU)(e,t)||l()}function v(e){var t=[];c(e,t),u.call(this,(0,y.combine)(t)),this._template=e}function _(){return arguments.length?new f(arguments[0]):new f}Object.defineProperty(n,"__esModule",{value:!0}),n.holding=r,n.AbstractMutable=o,n.MutableWithSource=u,n.LensedAtom=s,n.Atom=f,n.Molecule=v,n.default=_;var d=e("infestines"),y=e("kefir"),m=e("partial.lenses"),p=0,g=[],A=[];(0,d.inherit)(o,y.Property,{set:function(e){this.modify((0,d.always)(e))},remove:function(){this.set()},view:function(){return new s(this,m.compose.apply(void 0,arguments))},_maybeEmitValue:function(e){var t=this._currentEvent;t&&(0,d.identicalU)(t.value,e)||this._emitValue(e)}}),(0,d.inherit)(u,o,{get:function(){var e=this._currentEvent;return e&&!p?e.value:this._getFromSource()},_onAny:function(){this._maybeEmitValue(this._getFromSource())},_onActivation:function(){var e=this,t=function(){return e._onAny()};this._$onAny=t,this._source.onAny(t)},_onDeactivation:function(){this._source.offAny(this._$onAny),this._$onAny=null,this._currentEvent=null}}),(0,d.inherit)(s,u,{set:function(e){this._source.set((0,m.set)(this._lens,e,this._source.get()))},modify:function(e){this._source.modify((0,m.modify)(this._lens,e))},_getFromSource:function(){return(0,m.get)(this._lens,this._source.get())}}),(0,d.inherit)(f,o,{get:function(){var e=this._currentEvent;return e?e.value:void 0},set:function(e){var t=this._currentEvent;this._set(t,t?t.value:void 0,e)},modify:function(e){var t=this._currentEvent,n=t?t.value:void 0;this._set(t,n,e(n))},_set:function(e,t,n){p?(A.indexOf(this)<0&&(g.push(e?t:l),A.push(this)),e?e.value=n:this._currentEvent={type:"value",value:n}):this._maybeEmitValue(n)}}),(0,d.inherit)(v,u,{_getFromSource:function(){return a(this._template)},modify:function(e){var t=this,n=e(this.get());r(function(){return h(t._template,n)})}})},{infestines:void 0,kefir:void 0,"partial.lenses":void 0}]},{},[1])(1)});
